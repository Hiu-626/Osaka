<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>DuckTravel Planner</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- 2. Tailwind 設定 -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              duck: {
                yellow: '#FFD700',
                blue: '#1E90FF',
                red: '#FF4500',
                white: '#F7F9FC',
                dark: '#1e3a8a',
              }
            },
            fontFamily: {
              sans: ['ui-rounded', 'Nunito', 'Segoe UI', 'sans-serif'],
            }
          }
        }
      }
    </script>

    <style>
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      body {
        background-color: #E0F2FE;
        background-image: radial-gradient(#60A5FA 1px, transparent 1px);
        background-size: 20px 20px;
      }
    </style>

    <!-- 3. Import Map (話俾瀏覽器知 React 同 Firebase 喺邊度拎) -->
    <!-- 我改用了 esm.sh CDN，因為它對瀏覽器直接運行 React 比較穩定 -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>
    
    <!-- 4. Babel (讓瀏覽器睇得明 React JSX 寫法) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  
  <body>
    <!-- React 會將內容畫喺度 -->
    <div id="root"></div>

    <!-- 5. 主程式邏輯 (type="text/babel" 重要！) -->
    <script type="text/babel" data-type="module">
      import React, { useState } from 'react';
      import { createRoot } from 'react-dom/client';
      import { initializeApp } from 'firebase/app';
      import { getFirestore, collection, addDoc } from 'firebase/firestore';

      // ==========================================
      // 【請在這裡貼上你的 Firebase Config】
      // 去 Firebase Console -> Project Settings -> General -> 下面 Copy
      // ==========================================
      const firebaseConfig = {
  apiKey: "AIzaSyC2FhBEJC_VilXXm2i2l9rVjXthFUUQuao",
  authDomain: "travel-planner-d59ab.firebaseapp.com",
  projectId: "travel-planner-d59ab",
  storageBucket: "travel-planner-d59ab.firebasestorage.app",
  messagingSenderId: "845991687518",
  appId: "1:845991687518:web:8d356490f811f27fa6cbcf"
};
      };

      // 初始化 Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // --- React 组件 (畫面與邏輯) ---
      function App() {
        const [days, setDays] = useState("");
        const [budget, setBudget] = useState("");
        const [status, setStatus] = useState("");
        const [loading, setLoading] = useState(false);

        // 這是主要的「計算 + 儲存」功能
        const handleCalculateAndSave = async () => {
          if (!days || !budget) {
            alert("請輸入天數和預算！");
            return;
          }

          setLoading(true);
          setStatus("計算中...");

          // 1. 計算邏輯 (示範：每日平均預算)
          const totalBudget = parseFloat(budget);
          const numDays = parseInt(days);
          const dailyAverage = (totalBudget / numDays).toFixed(0);

          try {
            // 2. 儲存到 Firebase Firestore
            // 會儲存到叫 'trips' 的集合中
            const docRef = await addDoc(collection(db, "trips"), {
              days: numDays,
              totalBudget: totalBudget,
              dailyAverage: parseFloat(dailyAverage),
              createdAt: new Date()
            });

            setStatus(`成功！每日平均可用 $${dailyAverage}。資料已儲存 (ID: ${docRef.id})`);
            
            // 清空輸入
            setDays("");
            setBudget("");

          } catch (error) {
            console.error("Error:", error);
            setStatus("儲存失敗，請檢查 Console 或 Firebase 權限。");
          } finally {
            setLoading(false);
          }
        };

        return (
          <div className="min-h-screen flex items-center justify-center p-4">
            <div className="bg-white/80 backdrop-blur-md p-8 rounded-2xl shadow-xl w-full max-w-md border border-duck-blue/20">
              
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-duck-dark mb-2">
                  <i className="fa-solid fa-plane-departure text-duck-blue mr-2"></i>
                  DuckTravel Planner
                </h1>
                <p className="text-gray-500">輸入資料，自動計算並儲存</p>
              </div>

              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">旅行天數</label>
                  <input 
                    type="number" 
                    value={days}
                    onChange={(e) => setDays(e.target.value)}
                    className="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-duck-yellow focus:border-transparent outline-none transition"
                    placeholder="例如：5"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">總預算 ($)</label>
                  <input 
                    type="number" 
                    value={budget}
                    onChange={(e) => setBudget(e.target.value)}
                    className="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-duck-yellow focus:border-transparent outline-none transition"
                    placeholder="例如：10000"
                  />
                </div>

                <button 
                  onClick={handleCalculateAndSave}
                  disabled={loading}
                  className="w-full bg-duck-blue hover:bg-duck-dark text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:scale-[1.02] active:scale-95 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {loading ? (
                    <span><i className="fa-solid fa-spinner fa-spin mr-2"></i>處理中...</span>
                  ) : (
                    <span><i className="fa-solid fa-calculator mr-2"></i>計算並儲存</span>
                  )}
                </button>

                {status && (
                  <div className={`mt-4 p-3 rounded-lg text-sm text-center ${status.includes("成功") ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700"}`}>
                    {status}
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      // 將 App 渲染到 HTML 的 #root 位置
      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
